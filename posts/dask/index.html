<!DOCTYPE html>
<html lang="en" dir=>

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="How can we keep the simplicity and power of pandas, while extending it to be out-of-core and parallel?">
<meta name="theme-color" content="#FFFFFF"><meta property="og:title" content="Ad hoc Big Data Analysis with Dask" />
<meta property="og:description" content="How can we keep the simplicity and power of pandas, while extending it to be out-of-core and parallel?" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://dsevero.com/posts/dask/" /><meta property="og:image" content="https://dsevero.com/posts/dask/featured.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-03-19T00:00:00+00:00" />
<meta property="article:modified_time" content="2018-03-19T00:00:00+00:00" />

<title>Ad hoc Big Data Analysis with Dask | Daniel Severo</title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/book.min.a8f172e9514e766ee7562278ee2929cc668544eb977d0ee52069556d89261049.css" integrity="sha256-qPFy6VFOdm7nViJ47ikpzGaFROuXfQ7lIGlVbYkmEEk=">
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-82828654-2', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  
</head>

<body dir=>
  <input type="checkbox" class="hidden" id="menu-control" />
  <main class="container flex">
    <aside class="book-menu">
      
  <nav>
<h2 class="book-brand">
  <a href="/"><span>Daniel Severo</span>
  </a>
</h2>












  <ul>
<li><a href="/">About me</a></li>
<li><a href="/reading/">Reading</a></li>
<li><a href="/posts/">Writing</a></li>
</ul>






  
<ul>
  
  <li>
    <a href="https://github.com/dsevero" target="_blank" rel="noopener">
        Github
      </a>
  </li>
  
  <li>
    <a href="https://scholar.google.fr/citations?user=5bQjLz4AAAAJ" target="_blank" rel="noopener">
        Google Scholar
      </a>
  </li>
  
  <li>
    <a href="https://www.linkedin.com/in/danielsevero/" target="_blank" rel="noopener">
        LinkedIn
      </a>
  </li>
  
  <li>
    <a href="https://twitter.com/_dsevero" target="_blank" rel="noopener">
        Twitter
      </a>
  </li>
  
  <li>
    <a href="/cv.pdf" target="_blank" rel="noopener">
        CV
      </a>
  </li>
  
</ul>






</nav>




  <script>(function(){var e=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Ad hoc Big Data Analysis with Dask</strong>

  <label for="toc-control">
    
  </label>
</div>


  
 
      </header>

      
      
<article class="markdown">
  <h1>
    <a href="/posts/dask/">Ad hoc Big Data Analysis with Dask</a>
  </h1>
  
  <h5>Mar 19, 2018</h5>



  

  


  <p><p>Creating custom reports and machine learning models with pandas can be cumbersome with limited hardware resources (memory and CPU). Financial constraints can make spawning cloud instances to side-step this issue a problem, while adding the complexity of libraries such as Apache Spark isn&rsquo;t worth the trouble and staggers data exploration. <strong>How can we keep the simplicity and power of pandas, while extending it to be out-of-core and parallel?</strong></p>
<p>Enter <a href="https://dask.pydata.org/en/latest/">Dask</a>: a flexible parallel computing library for analytic computing. With it we will create a linear regression model to predict <a href="https://help.medium.com/hc/en-us/articles/214991667-Read-time">read time in Medium posts</a> using a Kaggle dataset, while comparing the equivalent implementation with pandas.</p>
<p>Consider leaving a <span style="text-shadow: none;"><a class="github-button" href="https://github.com/dsevero/dsevero.com" data-icon="octicon-star" data-size="small" data-show-count="true" aria-label="Star this on GitHub">Star</a><script async defer src="https://buttons.github.io/buttons.js"></script></span> if this helps you.</p>
<h3 id="1-kaggle-data">
  1. Kaggle data
  <a class="anchor" href="#1-kaggle-data">#</a>
</h3>
<p>We will be using the official kaggle api to automate our data fetching process.</p>
<ol>
<li>Log on to kaggle and enter the <a href="https://www.kaggle.com/c/how-good-is-your-medium-article">How good is your Medium article?</a> competition.</li>
<li>Configure the official kaggle api <a href="https://github.com/Kaggle/kaggle-api">following these steps</a>.</li>
</ol>
<p>For this tutorial we will need only 1 file.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kaggle competitions download -c how-good-is-your-medium-article -f train.json.gz
</span></span></code></pre></div><p>The reason for decompressing will become clear later.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gunzip -k ~/.kaggle/competitions/how-good-is-your-medium-article/train.json.gz
</span></span></code></pre></div><p>This sample file will help us speed up the analysis.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>head -n5 ~/.kaggle/competitions/how-good-is-your-medium-article/train.json &gt; <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>         ~/.kaggle/competitions/how-good-is-your-medium-article/train-sample.json
</span></span></code></pre></div><h3 id="2-exploration">
  2. Exploration.
  <a class="anchor" href="#2-exploration">#</a>
</h3>
<p>Despite the extension being json our data is stored as <a href="http://jsonlines.org/">jsonl</a>. This means that each line of <code>train.json</code> is a valid json file.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>head -n1 ~/.kaggle/competitions/how-good-is-your-medium-article/train.json | jq <span style="color:#e6db74">&#39;del(.content)&#39;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;_id&#34;</span>: <span style="color:#e6db74">&#34;https://medium.com/policy/medium-terms-of-service-9db0094a1e0f&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;_timestamp&#34;</span>: <span style="color:#ae81ff">1520035195.282891</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;_spider&#34;</span>: <span style="color:#e6db74">&#34;medium&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;url&#34;</span>: <span style="color:#e6db74">&#34;https://medium.com/policy/medium-terms-of-service-9db0094a1e0f&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;domain&#34;</span>: <span style="color:#e6db74">&#34;medium.com&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;published&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;$date&#34;</span>: <span style="color:#e6db74">&#34;2012-08-13T22:54:53.510Z&#34;</span>
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;title&#34;</span>: <span style="color:#e6db74">&#34;Medium Terms of Service – Medium Policy – Medium&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;author&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#66d9ef">null</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;url&#34;</span>: <span style="color:#e6db74">&#34;https://medium.com/@Medium&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;twitter&#34;</span>: <span style="color:#e6db74">&#34;@Medium&#34;</span>
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;image_url&#34;</span>: <span style="color:#66d9ef">null</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;tags&#34;</span>: [],
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;link_tags&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;canonical&#34;</span>: <span style="color:#e6db74">&#34;https://medium.com/policy/medium-terms-of-service-9db0094a1e0f&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;publisher&#34;</span>: <span style="color:#e6db74">&#34;https://plus.google.com/103654360130207659246&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;author&#34;</span>: <span style="color:#e6db74">&#34;https://medium.com/@Medium&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;search&#34;</span>: <span style="color:#e6db74">&#34;/osd.xml&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;alternate&#34;</span>: <span style="color:#e6db74">&#34;android-app://com.medium.reader/https/medium.com/p/9db0094a1e0f&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;stylesheet&#34;</span>: <span style="color:#e6db74">&#34;https://cdn-static-1.medium.com/_/fp/css/main-branding-base.Ch8g7KPCoGXbtKfJaVXo_w.css&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;icon&#34;</span>: <span style="color:#e6db74">&#34;https://cdn-static-1.medium.com/_/fp/icons/favicon-rebrand-medium.3Y6xpZ-0FSdWDnPM3hSBIA.ico&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;apple-touch-icon&#34;</span>: <span style="color:#e6db74">&#34;https://cdn-images-1.medium.com/fit/c/120/120/1*6_fgYnisCa9V21mymySIvA.png&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;mask-icon&#34;</span>: <span style="color:#e6db74">&#34;https://cdn-static-1.medium.com/_/fp/icons/monogram-mask.KPLCSFEZviQN0jQ7veN2RQ.svg&#34;</span>
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;meta_tags&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;viewport&#34;</span>: <span style="color:#e6db74">&#34;width=device-width, initial-scale=1&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;title&#34;</span>: <span style="color:#e6db74">&#34;Medium Terms of Service – Medium Policy – Medium&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;referrer&#34;</span>: <span style="color:#e6db74">&#34;unsafe-url&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;These Terms of Service (“Terms”) are a contract between you and A Medium Corporation. They govern your use of Medium’s sites, services, mobile apps, products, and content (“Services”). By using…&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;theme-color&#34;</span>: <span style="color:#e6db74">&#34;#000000&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;og:title&#34;</span>: <span style="color:#e6db74">&#34;Medium Terms of Service – Medium Policy – Medium&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;og:url&#34;</span>: <span style="color:#e6db74">&#34;https://medium.com/policy/medium-terms-of-service-9db0094a1e0f&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;fb:app_id&#34;</span>: <span style="color:#e6db74">&#34;542599432471018&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;og:description&#34;</span>: <span style="color:#e6db74">&#34;These Terms of Service (“Terms”) are a contract between you and A Medium Corporation. They govern your use of Medium’s sites, services, mobile apps, products, and content (“Services”). By using…&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;twitter:description&#34;</span>: <span style="color:#e6db74">&#34;These Terms of Service (“Terms”) are a contract between you and A Medium Corporation. They govern your use of Medium’s sites, services, mobile apps, products, and content (“Services”). By using…&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;author&#34;</span>: <span style="color:#e6db74">&#34;Medium&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;og:type&#34;</span>: <span style="color:#e6db74">&#34;article&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;twitter:card&#34;</span>: <span style="color:#e6db74">&#34;summary&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;article:publisher&#34;</span>: <span style="color:#e6db74">&#34;https://www.facebook.com/medium&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;article:author&#34;</span>: <span style="color:#e6db74">&#34;https://medium.com/@Medium&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;robots&#34;</span>: <span style="color:#e6db74">&#34;index, follow&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;article:published_time&#34;</span>: <span style="color:#e6db74">&#34;2012-08-13T22:54:53.510Z&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;twitter:creator&#34;</span>: <span style="color:#e6db74">&#34;@Medium&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;twitter:site&#34;</span>: <span style="color:#e6db74">&#34;@Medium&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;og:site_name&#34;</span>: <span style="color:#e6db74">&#34;Medium&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;twitter:label1&#34;</span>: <span style="color:#e6db74">&#34;Reading time&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;twitter:data1&#34;</span>: <span style="color:#e6db74">&#34;5 min read&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;twitter:app:name:iphone&#34;</span>: <span style="color:#e6db74">&#34;Medium&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;twitter:app:id:iphone&#34;</span>: <span style="color:#e6db74">&#34;828256236&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;twitter:app:url:iphone&#34;</span>: <span style="color:#e6db74">&#34;medium://p/9db0094a1e0f&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;al:ios:app_name&#34;</span>: <span style="color:#e6db74">&#34;Medium&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;al:ios:app_store_id&#34;</span>: <span style="color:#e6db74">&#34;828256236&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;al:android:package&#34;</span>: <span style="color:#e6db74">&#34;com.medium.reader&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;al:android:app_name&#34;</span>: <span style="color:#e6db74">&#34;Medium&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;al:ios:url&#34;</span>: <span style="color:#e6db74">&#34;medium://p/9db0094a1e0f&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;al:android:url&#34;</span>: <span style="color:#e6db74">&#34;medium://p/9db0094a1e0f&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;al:web:url&#34;</span>: <span style="color:#e6db74">&#34;https://medium.com/policy/medium-terms-of-service-9db0094a1e0f&#34;</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>I&rsquo;ve ommited the <code>content</code> field due to it&rsquo;s huge verbosity. Our problem requires that we use the fields <code>published.$date</code> and <code>meta_tags.twitter:data</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>head -n10 train.json | jq <span style="color:#e6db74">&#39;[.published[&#34;$date&#34;], .meta_tags[&#34;twitter:data1&#34;]] | @csv&#39;</span> -r
</span></span></code></pre></div><pre tabindex="0"><code>&#34;2012-08-13T22:54:53.510Z&#34;,&#34;5 min read&#34;
&#34;2015-08-03T07:44:50.331Z&#34;,&#34;7 min read&#34;
&#34;2017-02-05T13:08:17.410Z&#34;,&#34;2 min read&#34;
&#34;2017-05-06T08:16:30.776Z&#34;,&#34;3 min read&#34;
&#34;2017-06-04T14:46:25.772Z&#34;,&#34;4 min read&#34;
&#34;2017-04-02T16:21:15.171Z&#34;,&#34;7 min read&#34;
&#34;2016-08-15T04:16:02.103Z&#34;,&#34;12 min read&#34;
&#34;2015-01-14T21:31:07.568Z&#34;,&#34;5 min read&#34;
&#34;2014-02-11T04:11:54.771Z&#34;,&#34;4 min read&#34;
&#34;2015-10-25T02:58:05.551Z&#34;,&#34;8 min read&#34;
</code></pre><h3 id="3-building-the-time-series-the-good-the-bad-and-the-ugly">
  3. Building the time-series: The good, the bad and the ugly.
  <a class="anchor" href="#3-building-the-time-series-the-good-the-bad-and-the-ugly">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">%</span>matplotlib inline
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> json
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> pandas <span style="color:#66d9ef">as</span> pd
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> dask.bag <span style="color:#66d9ef">as</span> db
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> toolz.curried <span style="color:#f92672">import</span> get
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> typing <span style="color:#f92672">import</span> Dict
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>HOME <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>environ[<span style="color:#e6db74">&#39;HOME&#39;</span>]
</span></span><span style="display:flex;"><span>KAGGLE_DATASET_HOME <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;.kaggle/competitions/how-good-is-your-medium-article/&#39;</span>
</span></span><span style="display:flex;"><span>train_file <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>HOME<span style="color:#e6db74">}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">{</span>KAGGLE_DATASET_HOME<span style="color:#e6db74">}</span><span style="color:#e6db74">/train.json&#39;</span>
</span></span><span style="display:flex;"><span>train_sample_file <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>HOME<span style="color:#e6db74">}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">{</span>KAGGLE_DATASET_HOME<span style="color:#e6db74">}</span><span style="color:#e6db74">/train-sample.json&#39;</span>
</span></span><span style="display:flex;"><span>MEGABYTES <span style="color:#f92672">=</span> <span style="color:#ae81ff">1024</span><span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>
</span></span></code></pre></div><h4 id="the-ugly">
  The Ugly
  <a class="anchor" href="#the-ugly">#</a>
</h4>
<p><code>read_json</code> loads each json as a record, parsing each object beforehand.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span>    pd
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">.</span>read_json(train_sample_file, lines<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>    [[<span style="color:#e6db74">&#39;published&#39;</span>, <span style="color:#e6db74">&#39;meta_tags&#39;</span>]]
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>published</th>
      <th>meta_tags</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>{'$date': '2012-08-13T22:54:53.510Z'}</td>
      <td>{'viewport': 'width=device-width, initial-scal...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>{'$date': '2015-08-03T07:44:50.331Z'}</td>
      <td>{'viewport': 'width=device-width, initial-scal...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>{'$date': '2017-02-05T13:08:17.410Z'}</td>
      <td>{'viewport': 'width=device-width, initial-scal...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>{'$date': '2017-05-06T08:16:30.776Z'}</td>
      <td>{'viewport': 'width=device-width, initial-scal...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>{'$date': '2017-06-04T14:46:25.772Z'}</td>
      <td>{'viewport': 'width=device-width, initial-scal...</td>
    </tr>
  </tbody>
</table>
</div>
<p>Both columns have object values. Our fields of interest can be extracted and assigned to a new column using the <code>assign</code> function.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span>    _
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">.</span>assign(
</span></span><span style="display:flex;"><span>        published_timestamp <span style="color:#f92672">=</span> <span style="color:#66d9ef">lambda</span> df: df[<span style="color:#e6db74">&#39;published&#39;</span>]<span style="color:#f92672">.</span>apply(dict<span style="color:#f92672">.</span>get, args<span style="color:#f92672">=</span>(<span style="color:#e6db74">&#39;$date&#39;</span>,)),
</span></span><span style="display:flex;"><span>        read_time <span style="color:#f92672">=</span> <span style="color:#66d9ef">lambda</span> df: df[<span style="color:#e6db74">&#39;meta_tags&#39;</span>]<span style="color:#f92672">.</span>apply(dict<span style="color:#f92672">.</span>get, args<span style="color:#f92672">=</span>(<span style="color:#e6db74">&#39;twitter:data1&#39;</span>,)),
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>published</th>
      <th>meta_tags</th>
      <th>published_timestamp</th>
      <th>read_time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>{'$date': '2012-08-13T22:54:53.510Z'}</td>
      <td>{'viewport': 'width=device-width, initial-scal...</td>
      <td>2012-08-13T22:54:53.510Z</td>
      <td>5 min read</td>
    </tr>
    <tr>
      <th>1</th>
      <td>{'$date': '2015-08-03T07:44:50.331Z'}</td>
      <td>{'viewport': 'width=device-width, initial-scal...</td>
      <td>2015-08-03T07:44:50.331Z</td>
      <td>7 min read</td>
    </tr>
    <tr>
      <th>2</th>
      <td>{'$date': '2017-02-05T13:08:17.410Z'}</td>
      <td>{'viewport': 'width=device-width, initial-scal...</td>
      <td>2017-02-05T13:08:17.410Z</td>
      <td>2 min read</td>
    </tr>
    <tr>
      <th>3</th>
      <td>{'$date': '2017-05-06T08:16:30.776Z'}</td>
      <td>{'viewport': 'width=device-width, initial-scal...</td>
      <td>2017-05-06T08:16:30.776Z</td>
      <td>3 min read</td>
    </tr>
    <tr>
      <th>4</th>
      <td>{'$date': '2017-06-04T14:46:25.772Z'}</td>
      <td>{'viewport': 'width=device-width, initial-scal...</td>
      <td>2017-06-04T14:46:25.772Z</td>
      <td>4 min read</td>
    </tr>
  </tbody>
</table>
</div>
<p>Extracting the time value in <code>read_time</code> can be done with <code>pd.Series.str</code> processing methods. When called, the equivalent function is applied to each value, hence <code>.str.split(' ').str[0]</code> is equivalent to <code>'5 min read'.split(' ')[0]</code>.</p>
<p><code>astype</code> casts our columns to the necessary dtypes.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span>    _
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">.</span>assign(read_time <span style="color:#f92672">=</span> <span style="color:#66d9ef">lambda</span> df: df[<span style="color:#e6db74">&#39;read_time&#39;</span>]<span style="color:#f92672">.</span>str<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#39; &#39;</span>)<span style="color:#f92672">.</span>str[<span style="color:#ae81ff">0</span>])
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">.</span>astype({
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;read_time&#39;</span>: int,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;published_timestamp&#39;</span>: <span style="color:#e6db74">&#39;datetime64[ns]&#39;</span>
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">.</span>set_index(<span style="color:#e6db74">&#39;published_timestamp&#39;</span>)
</span></span><span style="display:flex;"><span>    [<span style="color:#e6db74">&#39;read_time&#39;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">.</span>to_frame()
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>read_time</th>
    </tr>
    <tr>
      <th>published_timestamp</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2012-08-13 22:54:53.510</th>
      <td>5</td>
    </tr>
    <tr>
      <th>2015-08-03 07:44:50.331</th>
      <td>7</td>
    </tr>
    <tr>
      <th>2017-02-05 13:08:17.410</th>
      <td>2</td>
    </tr>
    <tr>
      <th>2017-05-06 08:16:30.776</th>
      <td>3</td>
    </tr>
    <tr>
      <th>2017-06-04 14:46:25.772</th>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div>
<h4 id="the-bad">
  The Bad
  <a class="anchor" href="#the-bad">#</a>
</h4>
<p>The issue with The Ugly solution is that <code>read_json</code> loads the entire dataset into memory before slicing the necessary columns (<code>published</code> and <code>meta_tags</code>). Pre-processing our data with pure python consumes less RAM.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">make_datum</span>(x):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;published_timestamp&#39;</span>: x[<span style="color:#e6db74">&#39;published&#39;</span>][<span style="color:#e6db74">&#39;$date&#39;</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;read_time&#39;</span>: x[<span style="color:#e6db74">&#39;meta_tags&#39;</span>][<span style="color:#e6db74">&#39;twitter:data1&#39;</span>]
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">with</span> open(train_sample_file, <span style="color:#e6db74">&#39;r&#39;</span>) <span style="color:#66d9ef">as</span> f:    
</span></span><span style="display:flex;"><span>    bad_df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame([make_datum(json<span style="color:#f92672">.</span>loads(x)) <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> f])
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>bad_df
</span></span></code></pre></div><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>published_timestamp</th>
      <th>read_time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2012-08-13T22:54:53.510Z</td>
      <td>5 min read</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2015-08-03T07:44:50.331Z</td>
      <td>7 min read</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2017-02-05T13:08:17.410Z</td>
      <td>2 min read</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2017-05-06T08:16:30.776Z</td>
      <td>3 min read</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2017-06-04T14:46:25.772Z</td>
      <td>4 min read</td>
    </tr>
  </tbody>
</table>
</div>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span>    _
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">.</span>assign(read_time <span style="color:#f92672">=</span> <span style="color:#66d9ef">lambda</span> x: x[<span style="color:#e6db74">&#39;read_time&#39;</span>]<span style="color:#f92672">.</span>str<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#39; &#39;</span>)<span style="color:#f92672">.</span>str[<span style="color:#ae81ff">0</span>])
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">.</span>astype({
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;published_timestamp&#39;</span>: <span style="color:#e6db74">&#39;datetime64[ns]&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;read_time&#39;</span>: int
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">.</span>set_index(<span style="color:#e6db74">&#39;published_timestamp&#39;</span>)
</span></span><span style="display:flex;"><span>    [<span style="color:#e6db74">&#39;read_time&#39;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">.</span>to_frame()
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>read_time</th>
    </tr>
    <tr>
      <th>published_timestamp</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2012-08-13 22:54:53.510</th>
      <td>5</td>
    </tr>
    <tr>
      <th>2015-08-03 07:44:50.331</th>
      <td>7</td>
    </tr>
    <tr>
      <th>2017-02-05 13:08:17.410</th>
      <td>2</td>
    </tr>
    <tr>
      <th>2017-05-06 08:16:30.776</th>
      <td>3</td>
    </tr>
    <tr>
      <th>2017-06-04 14:46:25.772</th>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div>
<h4 id="the-good">
  The Good
  <a class="anchor" href="#the-good">#</a>
</h4>
<p>Dask allows us to build lazy computational graphs. For example, <code>db.read_text</code> will return a reference to each line of our jsonl file. After, <code>.map</code> applies <code>json.loads</code> to each line and <code>.to_dataframe</code> casts the data to a dask DataFrame preserving <strong>only</strong> the columns we explicitly tell it (in this case <code>published</code> and <code>meta_tags</code>). The rest of the code proceeds analogously with the previous implementations. The only difference is that <strong>dask won&rsquo;t actually process anything until we call the <code>.compute</code> method</strong>, returning a pandas DataFrame. In other words, a dask DataFrame is a lazy version of a pandas DataFrame. The same is true for series.</p>
<p>Notice how we pass the <code>blocksize</code> parameter as 100 MB. Since our file has 2 GB, dask creates 20 independent partitions. Most methods that are called (like <code>.map</code> and <code>.assign</code>) run in parallel, potentially speeding up computation significantly. Memory is also spared, since we only load the fields we need.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>dag <span style="color:#f92672">=</span> (
</span></span><span style="display:flex;"><span>    db
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">.</span>read_text(train_file, blocksize<span style="color:#f92672">=</span><span style="color:#ae81ff">100</span><span style="color:#f92672">*</span>MEGABYTES)
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">.</span>map(json<span style="color:#f92672">.</span>loads)
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">.</span>to_dataframe({
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;published&#39;</span>: object,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;meta_tags&#39;</span>: object
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">.</span>assign(
</span></span><span style="display:flex;"><span>        published_timestamp<span style="color:#f92672">=</span><span style="color:#66d9ef">lambda</span> df: df[<span style="color:#e6db74">&#39;published&#39;</span>]<span style="color:#f92672">.</span>apply(get(<span style="color:#e6db74">&#39;$date&#39;</span>)),
</span></span><span style="display:flex;"><span>        read_time<span style="color:#f92672">=</span><span style="color:#66d9ef">lambda</span> df: df[<span style="color:#e6db74">&#39;meta_tags&#39;</span>]<span style="color:#f92672">.</span>apply(get(<span style="color:#e6db74">&#39;twitter:data1&#39;</span>))<span style="color:#f92672">.</span>str<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#39; &#39;</span>)<span style="color:#f92672">.</span>str[<span style="color:#ae81ff">0</span>],
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">.</span>astype({
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;published_timestamp&#39;</span>: <span style="color:#e6db74">&#39;datetime64[ns]&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;read_time&#39;</span>: int
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>    [[<span style="color:#e6db74">&#39;published_timestamp&#39;</span>, <span style="color:#e6db74">&#39;read_time&#39;</span>]]
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>dag
</span></span></code></pre></div><div><strong>Dask DataFrame Structure:</strong></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>published_timestamp</th>
      <th>read_time</th>
    </tr>
    <tr>
      <th>npartitions=20</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th></th>
      <td>datetime64[ns]</td>
      <td>int64</td>
    </tr>
    <tr>
      <th></th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th></th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th></th>
      <td>...</td>
      <td>...</td>
    </tr>
  </tbody>
</table>
</div>
<div>Dask Name: getitem, 120 tasks</div>
<p>Other methods like <code>.head(N)</code> also force the dataframe to be computed. Since this call needs only the first <code>N</code> rows, dask will partially solve the graph such that only those are processed.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span>    _
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">.</span>head()
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">.</span>set_index(<span style="color:#e6db74">&#39;published_timestamp&#39;</span>)
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>read_time</th>
    </tr>
    <tr>
      <th>published_timestamp</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2012-08-13 22:54:53.510</th>
      <td>5</td>
    </tr>
    <tr>
      <th>2015-08-03 07:44:50.331</th>
      <td>7</td>
    </tr>
    <tr>
      <th>2017-02-05 13:08:17.410</th>
      <td>2</td>
    </tr>
    <tr>
      <th>2017-05-06 08:16:30.776</th>
      <td>3</td>
    </tr>
    <tr>
      <th>2017-06-04 14:46:25.772</th>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div>
<h1 id="4-prediction">
  4. Prediction
  <a class="anchor" href="#4-prediction">#</a>
</h1>
<p>Here we will implement simple linear regression for a single variable with intercept: $y = \alpha + \beta x$, the closed form solution is:</p>
<p>$$\beta = \frac{cov(x,y)}{var(x)}$$
$$\alpha = \bar{y} - \beta \bar{x}$$</p>
<p>where $\bar{y}$ and $\bar{x}$ are the average values of the vectors $y$ and $x$, respectively.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">linear_regression</span>(y: np<span style="color:#f92672">.</span>array, x: np<span style="color:#f92672">.</span>array, prefix<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&#39;</span>) <span style="color:#f92672">-&gt;</span> Dict[str, float]:
</span></span><span style="display:flex;"><span>    M <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>cov(x, y)
</span></span><span style="display:flex;"><span>    beta <span style="color:#f92672">=</span> M[<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">1</span>]<span style="color:#f92672">/</span>M[<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>    alpha <span style="color:#f92672">=</span> y<span style="color:#f92672">.</span>mean() <span style="color:#f92672">-</span> beta<span style="color:#f92672">*</span>x<span style="color:#f92672">.</span>mean()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> {
</span></span><span style="display:flex;"><span>        prefix <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;alpha&#39;</span>: alpha, 
</span></span><span style="display:flex;"><span>        prefix <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;beta&#39;</span>: beta
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df <span style="color:#f92672">=</span> (
</span></span><span style="display:flex;"><span>    dag
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">.</span>compute()
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">.</span>set_index(<span style="color:#e6db74">&#39;published_timestamp&#39;</span>)
</span></span><span style="display:flex;"><span>    [<span style="color:#e6db74">&#39;2015&#39;</span>:]
</span></span><span style="display:flex;"><span>    [<span style="color:#e6db74">&#39;read_time&#39;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">.</span>groupby(<span style="color:#66d9ef">lambda</span> i: pd<span style="color:#f92672">.</span>to_datetime(i<span style="color:#f92672">.</span>strftime(<span style="color:#e6db74">&#39;%Y/%m&#39;</span>)))
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">.</span>agg([<span style="color:#e6db74">&#39;mean&#39;</span>, <span style="color:#e6db74">&#39;sum&#39;</span>])
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>df<span style="color:#f92672">.</span>head()
</span></span></code></pre></div><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mean</th>
      <th>sum</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2015-01-01</th>
      <td>8.380952</td>
      <td>4928</td>
    </tr>
    <tr>
      <th>2015-02-01</th>
      <td>7.887564</td>
      <td>4630</td>
    </tr>
    <tr>
      <th>2015-03-01</th>
      <td>7.907840</td>
      <td>5749</td>
    </tr>
    <tr>
      <th>2015-04-01</th>
      <td>7.667149</td>
      <td>5298</td>
    </tr>
    <tr>
      <th>2015-05-01</th>
      <td>8.307506</td>
      <td>6862</td>
    </tr>
  </tbody>
</table>
</div>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df<span style="color:#f92672">.</span>plot(
</span></span><span style="display:flex;"><span>    style<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;o--&#39;</span>, <span style="color:#e6db74">&#39;og--&#39;</span>], figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">12</span>,<span style="color:#ae81ff">6</span>),
</span></span><span style="display:flex;"><span>    subplots<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, title<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Medium read time&#39;</span>, fontsize<span style="color:#f92672">=</span><span style="color:#ae81ff">12</span>
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></div><p><img src="./2018-03-19%20Ad%20hoc%20Big%20Data%20Analysis%20with%20Dask_32_0.png" alt="png" /></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df_pred <span style="color:#f92672">=</span> (
</span></span><span style="display:flex;"><span>    df
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">.</span>assign(<span style="color:#f92672">**</span>linear_regression(df[<span style="color:#e6db74">&#39;mean&#39;</span>], df<span style="color:#f92672">.</span>index<span style="color:#f92672">.</span>asi8, prefix<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;mean_&#39;</span>))
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">.</span>assign(<span style="color:#f92672">**</span>linear_regression(df[<span style="color:#e6db74">&#39;sum&#39;</span>], df<span style="color:#f92672">.</span>index<span style="color:#f92672">.</span>asi8, prefix<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;sum_&#39;</span>))
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">.</span>assign(mean_pred <span style="color:#f92672">=</span> <span style="color:#66d9ef">lambda</span> z: z[<span style="color:#e6db74">&#39;mean_alpha&#39;</span>] <span style="color:#f92672">+</span> z[<span style="color:#e6db74">&#39;mean_beta&#39;</span>]<span style="color:#f92672">*</span>z<span style="color:#f92672">.</span>index<span style="color:#f92672">.</span>asi8)
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">.</span>assign(sum_pred <span style="color:#f92672">=</span> <span style="color:#66d9ef">lambda</span> z: z[<span style="color:#e6db74">&#39;sum_alpha&#39;</span>] <span style="color:#f92672">+</span> z[<span style="color:#e6db74">&#39;sum_beta&#39;</span>]<span style="color:#f92672">*</span>z<span style="color:#f92672">.</span>index<span style="color:#f92672">.</span>asi8)
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>df_pred[[<span style="color:#e6db74">&#39;mean_alpha&#39;</span>, <span style="color:#e6db74">&#39;mean_beta&#39;</span>, <span style="color:#e6db74">&#39;sum_alpha&#39;</span>, <span style="color:#e6db74">&#39;sum_beta&#39;</span>, <span style="color:#e6db74">&#39;mean_pred&#39;</span>, <span style="color:#e6db74">&#39;sum_pred&#39;</span>]]<span style="color:#f92672">.</span>head()
</span></span></code></pre></div><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mean_alpha</th>
      <th>mean_beta</th>
      <th>sum_alpha</th>
      <th>sum_beta</th>
      <th>mean_pred</th>
      <th>sum_pred</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2015-01-01</th>
      <td>27.130799</td>
      <td>-1.351069e-17</td>
      <td>-407905.660648</td>
      <td>2.892460e-13</td>
      <td>7.944669</td>
      <td>2844.030846</td>
    </tr>
    <tr>
      <th>2015-02-01</th>
      <td>27.130799</td>
      <td>-1.351069e-17</td>
      <td>-407905.660648</td>
      <td>2.892460e-13</td>
      <td>7.908482</td>
      <td>3618.747348</td>
    </tr>
    <tr>
      <th>2015-03-01</th>
      <td>27.130799</td>
      <td>-1.351069e-17</td>
      <td>-407905.660648</td>
      <td>2.892460e-13</td>
      <td>7.875797</td>
      <td>4318.491286</td>
    </tr>
    <tr>
      <th>2015-04-01</th>
      <td>27.130799</td>
      <td>-1.351069e-17</td>
      <td>-407905.660648</td>
      <td>2.892460e-13</td>
      <td>7.839610</td>
      <td>5093.207789</td>
    </tr>
    <tr>
      <th>2015-05-01</th>
      <td>27.130799</td>
      <td>-1.351069e-17</td>
      <td>-407905.660648</td>
      <td>2.892460e-13</td>
      <td>7.804590</td>
      <td>5842.933436</td>
    </tr>
  </tbody>
</table>
</div>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span>    df_pred
</span></span><span style="display:flex;"><span>    [[<span style="color:#e6db74">&#39;mean&#39;</span>, <span style="color:#e6db74">&#39;mean_pred&#39;</span>]]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">.</span>plot(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">12</span>,<span style="color:#ae81ff">5</span>), style<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;o--&#39;</span>, <span style="color:#e6db74">&#39;--&#39;</span>])
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></div><p><img src="./2018-03-19%20Ad%20hoc%20Big%20Data%20Analysis%20with%20Dask_34_0.png" alt="png" /></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span>    df_pred
</span></span><span style="display:flex;"><span>    [[<span style="color:#e6db74">&#39;sum&#39;</span>, <span style="color:#e6db74">&#39;sum_pred&#39;</span>]]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">.</span>plot(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">12</span>,<span style="color:#ae81ff">5</span>), style<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;o--&#39;</span>, <span style="color:#e6db74">&#39;--&#39;</span>])
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></div><p><img src="./2018-03-19%20Ad%20hoc%20Big%20Data%20Analysis%20with%20Dask_35_0.png" alt="png" /></p>
</p>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





</div>

 
        
      </footer>

      
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
  </main>

  
</body>

</html>












